<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ’› ×—×™-×××ª VOICE | Hai-Emet</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/8.5.0/docx.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f0f2f5;
            direction: rtl;
        }
        
        .app-container {
            display: flex;
            width: 100%;
            height: 100vh;
        }
        
        /* ============ SIDEBAR PANEL LEFT ============ */
        .voice-panel {
            width: 0;
            background: white;
            border-left: 1px solid #e0e0e0;
            overflow: hidden;
            transition: width 0.3s ease;
            display: flex;
            flex-direction: column;
            box-shadow: -2px 0 10px rgba(0,0,0,0.05);
        }
        
        .voice-panel.open {
            width: 320px;
        }
        
        .panel-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            font-weight: bold;
            text-align: center;
            font-size: 1em;
            white-space: nowrap;
        }
        
        .panel-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 15px;
            display: flex;
            flex-direction: column;
        }
        
        .section-title {
            font-size: 0.9em;
            font-weight: bold;
            color: #667eea;
            margin: 12px 0 8px 0;
            padding-bottom: 6px;
            border-bottom: 2px solid #667eea;
        }
        
        .transcription-box {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            border: 2px solid #667eea;
            margin-bottom: 12px;
            min-height: 80px;
            max-height: 250px;
            overflow-y: auto;
            word-break: break-word;
            white-space: normal;
            line-height: 1.6;
        }
        
        .transcription-label {
            font-size: 0.75em;
            color: #999;
            font-weight: 600;
            margin-bottom: 6px;
            text-transform: uppercase;
        }
        
        #finalTranscript {
            font-size: 1.05em;
            font-weight: 600;
            color: #000;
            line-height: 1.6;
            word-break: break-word;
            white-space: pre-wrap;
        }
        
        #translatedText {
            font-size: 0.95em;
            color: #667eea;
            font-weight: 500;
            line-height: 1.5;
            word-break: break-word;
            white-space: pre-wrap;
        }
        
        .status-indicator {
            background: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85em;
            text-align: center;
            color: #667eea;
            font-weight: 600;
            margin-bottom: 12px;
            border: 1px solid #e0e0e0;
        }
        
        .control-btn {
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            padding: 10px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            transition: all 0.3s;
            text-align: center;
            width: 100%;
            margin-bottom: 8px;
        }
        
        .control-btn:hover {
            background: #667eea;
            color: white;
        }
        
        .control-btn.recording {
            background: #ff6b6b;
            color: white;
            border-color: #ff6b6b;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .lang-select {
            padding: 10px 12px;
            border-radius: 8px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.9em;
            width: 100%;
            margin-bottom: 8px;
        }
        
        .file-upload-box {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            border: 2px dashed #667eea;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-upload-box:hover {
            background: #e9ecef;
            border-color: #764ba2;
        }
        
        .file-upload-box input {
            display: none;
        }
        
        .files-list {
            margin-top: 8px;
        }
        
        .file-item {
            background: #f8f9fa;
            padding: 8px;
            border-radius: 6px;
            margin-bottom: 6px;
            border: 1px solid #e0e0e0;
            font-size: 0.85em;
        }
        
        .file-name {
            font-weight: 600;
            color: #333;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* ============ MAIN CHAT AREA ============ */
        .main-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 2em;
            margin-bottom: 5px;
        }
        
        .header p {
            font-size: 0.9em;
            opacity: 0.95;
        }
        
        .badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            margin-top: 10px;
        }
        
        .toggle-panel-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            z-index: 100;
            transition: all 0.3s;
        }
        
        .toggle-panel-btn:hover {
            transform: scale(1.05);
        }
        
        .chat-area {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: #f8f9fa;
            display: flex;
            flex-direction: column;
        }
        
        .message {
            margin-bottom: 12px;
            display: flex;
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message.user {
            justify-content: flex-start;
        }
        
        .message.assistant {
            justify-content: flex-end;
        }
        
        .message-wrapper {
            display: flex;
            flex-direction: column;
        }
        
        .message.user .message-wrapper {
            align-items: flex-start;
        }
        
        .message.assistant .message-wrapper {
            align-items: flex-end;
        }
        
        .message-content {
            max-width: 70%;
            padding: 12px 15px;
            border-radius: 15px;
            word-wrap: break-word;
        }
        
        .message.user .message-content {
            background: #667eea;
            color: white;
            border-bottom-left-radius: 0;
        }
        
        .message.assistant .message-content {
            background: white;
            color: #333;
            border-bottom-right-radius: 0;
            border: 1px solid #e0e0e0;
        }
        
        .message-time {
            font-size: 0.65em;
            color: #999;
            padding: 5px 10px;
        }
        
        .input-area {
            padding: 15px;
            background: white;
            border-top: 1px solid #e0e0e0;
        }
        
        .input-wrapper {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        input[type="text"] {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 1em;
            transition: border-color 0.3s;
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .send-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            white-space: nowrap;
            font-size: 1em;
        }
        
        .empty-files {
            text-align: center;
            color: #999;
            font-size: 0.85em;
            padding: 10px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- VOICE PANEL (LEFT) -->
        <div class="voice-panel" id="voicePanel">
            <div class="panel-header">ğŸ¤ ×˜×§×¡×˜ ×‘×–××Ÿ ×××ª</div>
            
            <div class="panel-content">
                <!-- STATUS -->
                <div class="status-indicator" id="statusIndicator">
                    âœ… Ready
                </div>
                
                <!-- RECORD BUTTON -->
                <button class="control-btn" id="recordBtn" onclick="toggleRecording()">
                    ğŸ¤ ×”×§×œ×˜
                </button>
                
                <button class="control-btn" onclick="clearTranscription()" style="border-color: #ff9800; color: #ff9800; margin-top: 8px;">
                    ğŸ”„ × ×§×” ×˜×§×¡×˜
                </button>
                
                <!-- VOICE LANGUAGE -->
                <div class="section-title">×©×¤×ª ×§×•×œ</div>
                <select class="lang-select" id="voiceLang" onchange="changeVoiceLanguage()">
                    <option value="he-IL">ğŸ‡®ğŸ‡± ×¢×‘×¨×™×ª (Hebrew)</option>
                    <option value="en-US">ğŸ‡ºğŸ‡¸ English (×× ×’×œ×™×ª)</option>
                    <option value="es-ES">ğŸ‡ªğŸ‡¸ EspaÃ±ol (×¡×¤×¨×“×™×ª)</option>
                    <option value="fr-FR">ğŸ‡«ğŸ‡· FranÃ§ais (×¦×¨×¤×ª×™×ª)</option>
                    <option value="de-DE">ğŸ‡©ğŸ‡ª Deutsch (×’×¨×× ×™×ª)</option>
                    <option value="it-IT">ğŸ‡®ğŸ‡¹ Italiano (××™×˜×œ×§×™×ª)</option>
                    <option value="pt-PT">ğŸ‡µğŸ‡¹ PortuguÃªs (×¤×•×¨×˜×•×’×–×™×ª)</option>
                    <option value="ru-RU">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹ (×¨×•×¡×™×ª)</option>
                    <option value="ar-SA">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (×¢×¨×‘×™×ª)</option>
                    <option value="ja-JP">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª (×™×¤× ×™×ª)</option>
                    <option value="zh-CN">ğŸ‡¨ğŸ‡³ ä¸­æ–‡ (×¡×™× ×™×ª)</option>
                    <option value="ko-KR">ğŸ‡°ğŸ‡· í•œêµ­ì–´ (×§×•×¨×™×× ×™×ª)</option>
                    <option value="hi-IN">ğŸ‡®ğŸ‡³ à¤¹à¤¿à¤¨à¥à¤¦à¥€ (×”×™× ×“×™×ª)</option>
                    <option value="nl-NL">ğŸ‡³ğŸ‡± Nederlands (×”×•×œ× ×“×™×ª)</option>
                    <option value="pl-PL">ğŸ‡µğŸ‡± Polski (×¤×•×œ× ×™×ª)</option>
                </select>
                
                <!-- TRANSLATION LANGUAGE -->
                <div class="section-title" style="margin-top: 15px;">×ª×¨×’×•×</div>
                <select class="lang-select" id="translateLang" onchange="changeTranslateLanguage()">
                    <option value="">ğŸŒ ×œ× ×œ×ª×¨×’×</option>
                    <option value="he">ğŸ‡®ğŸ‡± ×¢×‘×¨×™×ª</option>
                    <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                    <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                    <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
                    <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
                    <option value="it">ğŸ‡®ğŸ‡¹ Italiano</option>
                    <option value="pt">ğŸ‡µğŸ‡¹ PortuguÃªs</option>
                    <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                    <option value="ar">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                    <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                    <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
                    <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
                    <option value="hi">ğŸ‡®ğŸ‡³ à¤¹à¤¿à¤¨à¥à¤¦à¥€</option>
                    <option value="nl">ğŸ‡³ğŸ‡± Nederlands</option>
                    <option value="pl">ğŸ‡µğŸ‡± Polski</option>
                </select>
                
                <div class="transcription-box" id="translatedBox" style="display: none; margin-top: 12px;">
                    <div class="transcription-label">×ª×¨×’×•× ×‘×–××Ÿ ×××ª</div>
                    <div id="translatedText"></div>
                </div>
                
                <!-- TRANSCRIPTION -->
                <div class="section-title" style="margin-top: 15px;">×˜×¨× ×¡×§×¨×™×¤×¦×™×”</div>
                
                <div class="transcription-box" style="min-height: 200px; max-height: 300px;">
                    <div class="transcription-label">×˜×§×¡×˜ ×‘×–××Ÿ ×××ª</div>
                    <div id="finalTranscript"></div>
                </div>
                
                <!-- FILE MANAGEMENT -->
                <div class="section-title">×©××™×¨×”</div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                    <button class="control-btn" onclick="saveTranscriptionTXT()" style="border-color: #28a745; color: #28a745; margin-bottom: 0;">
                        ğŸ“„ TXT
                    </button>
                    <button class="control-btn" onclick="saveTranscriptionDOCX()" style="border-color: #28a745; color: #28a745; margin-bottom: 0;">
                        ğŸ“‹ DOCX
                    </button>
                </div>
                
                <!-- FILE UPLOADS - ACCORDION -->
                <div class="section-title" style="cursor: pointer; user-select: none;" onclick="toggleUploadAccordion(this)">
                    â–¶ ×”×¢×œ××”
                </div>
                
                <div id="uploadAccordion" style="display: none; margin-bottom: 15px;">
                    <div class="file-upload-box" onclick="document.getElementById('audioInput').click()" style="margin-bottom: 8px;">
                        ğŸµ ×¡××•× ×“ (MP3, WAV, M4A)
                        <input type="file" id="audioInput" accept="audio/*" onchange="handleAudioUpload(event)">
                    </div>
                    
                    <div class="file-upload-box" onclick="document.getElementById('videoInput').click()" style="margin-bottom: 8px;">
                        ğŸ¬ ×¡×¨×˜ (MP4, WebM, MOV)
                        <input type="file" id="videoInput" accept="video/*" onchange="handleVideoUpload(event)">
                    </div>
                    
                    <div class="file-upload-box" onclick="document.getElementById('txtInput').click()" style="margin-bottom: 8px;">
                        ğŸ“„ ×˜×§×¡×˜ TXT
                        <input type="file" id="txtInput" accept=".txt" onchange="handleTxtUpload(event)">
                    </div>
                    
                    <div class="file-upload-box" onclick="document.getElementById('docxInput').click()">
                        ğŸ“‹ DOCX Word
                        <input type="file" id="docxInput" accept=".docx" onchange="handleDocxUpload(event)">
                    </div>
                </div>
                
                <!-- FILES LIST -->
                <div class="section-title">×§×‘×¦×™×</div>
                <div id="filesList" class="files-list">
                    <div class="empty-files">××™×Ÿ ×§×‘×¦×™× ×¢×“×™×™×Ÿ</div>
                </div>
                
                <button class="control-btn" onclick="clearAllFiles()" style="border-color: #ff6b6b; color: #ff6b6b;">
                    ğŸ—‘ï¸ ××—×§ ×”×›×œ
                </button>
                
                <!-- ADVANCED: VIDEO/STREAM SECTION -->
                <div class="section-title" style="margin-top: 15px; cursor: pointer; user-select: none;" onclick="toggleStreamAccordion(this)">
                    â–¶ ×•×™×“××• / ×©×“×•×¨ ×—×™
                </div>
                
                <div id="streamAccordion" style="display: none;">
                    <div style="margin-bottom: 8px;">
                        <div style="font-weight: bold; color: #667eea; margin-bottom: 6px;">ğŸ¬ ×¡×•×’×™ ×§×œ×˜:</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 8px;">
                            <button class="control-btn" onclick="showYouTubeInput()" style="border-color: #FF0000; color: #FF0000; margin-bottom: 0; font-size: 0.9em;">
                                ğŸ“º YouTube
                            </button>
                            <button class="control-btn" onclick="showLiveStreamInput()" style="border-color: #00AA00; color: #00AA00; margin-bottom: 0; font-size: 0.9em;">
                                ğŸ“¡ ×©×™×“×•×¨ ×—×™
                            </button>
                        </div>
                    </div>
                    
                    <div id="youtubeInputArea" style="display: none; margin-bottom: 8px; padding: 10px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #FF0000;">
                        <input type="text" id="youtubeURL" placeholder="https://www.youtube.com/watch?v=..." 
                            style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #FF0000; margin-bottom: 8px; font-size: 0.9em;">
                        <button class="control-btn" onclick="loadYouTubeVideo()" style="width: 100%; margin-bottom: 0; border-color: #FF0000; color: #FF0000;">
                            â–¶ ×”×¤×¢×œ YouTube
                        </button>
                    </div>
                    
                    <div id="liveStreamInputArea" style="display: none; margin-bottom: 8px; padding: 10px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #00AA00;">
                        <input type="text" id="streamURL2" placeholder="https://example.com/stream ××• https://example.com/video.mp4" 
                            style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #00AA00; margin-bottom: 8px; font-size: 0.9em;">
                        <button class="control-btn" onclick="loadLiveStream()" style="width: 100%; margin-bottom: 0; border-color: #00AA00; color: #00AA00;">
                            â–¶ ×”×¤×¢×œ ×©×™×“×•×¨
                        </button>
                    </div>
                    
                    <div style="margin-bottom: 8px; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                        <div style="font-weight: bold; margin-bottom: 6px; color: #667eea;">ğŸ“ ×›×ª×•×‘×™×•×ª/×˜×§×¡×˜:</div>
                        <textarea id="videoSubtitles" placeholder="×”×“×‘×§ ×›×ª×•×‘×™×•×ª ××• ×˜×§×¡×˜ ××”×¡×¨×˜×•×Ÿ..." 
                            style="width: 100%; height: 100px; padding: 8px; border-radius: 6px; border: 1px solid #667eea; resize: vertical; font-size: 0.9em; direction: rtl; text-align: right;"></textarea>
                        <button class="control-btn" onclick="processVideoSubtitles()" style="width: 100%; margin-top: 8px; margin-bottom: 0;">
                            âœ… ×¢×“×›×Ÿ ×›×ª×•×‘×™×•×ª
                        </button>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 8px;">
                        <button class="control-btn" id="audioStreamBtn" onclick="startAudioStreaming()" style="border-color: #667eea; color: #667eea; margin-bottom: 0; font-size: 0.9em;">
                            ğŸ™ï¸ ×”×§×œ×˜ ××•×“×™×•
                        </button>
                        <button class="control-btn" onclick="stopAudioStreaming()" style="border-color: #ff6b6b; color: #ff6b6b; margin-bottom: 0; font-size: 0.9em;">
                            â¹ï¸ ×¢×¦×•×¨
                        </button>
                    </div>
                    
                    <div id="videoContainer" style="margin-top: 8px; display: none; border-radius: 8px; overflow: hidden; background: #000;">
                        <div id="videoPlayerWrapper" style="width: 100%; background: #f8f9fa; border-radius: 8px; margin-bottom: 8px; overflow: hidden;">
                            <video id="videoPlayer" width="100%" height="auto" controls style="display: none; background: #000;">
                                Your browser does not support the video tag.
                            </video>
                        </div>
                        
                        <div style="margin-bottom: 8px;">
                            <div style="font-weight: bold; color: #667eea; margin-bottom: 4px;">ğŸŒ ×‘×—×¨ ×©×¤×” ×œ×ª×¨×’×•×:</div>
                            <select id="videoTranslang" onchange="updateVideoTranslation()" 
                                style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #667eea; font-size: 0.9em;">
                                <option value="">ğŸŒ ×‘×—×¨ ×©×¤×”</option>
                                <option value="he">ğŸ‡®ğŸ‡± ×¢×‘×¨×™×ª</option>
                                <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                                <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                                <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
                                <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
                                <option value="it">ğŸ‡®ğŸ‡¹ Italiano</option>
                                <option value="pt">ğŸ‡µğŸ‡¹ PortuguÃªs</option>
                                <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                                <option value="ar">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                                <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                                <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
                                <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
                                <option value="hi">ğŸ‡®ğŸ‡³ à¤¹à¤¿à¤¨à¥à¤¦à¥€</option>
                                <option value="nl">ğŸ‡³ğŸ‡± Nederlands</option>
                                <option value="pl">ğŸ‡µğŸ‡± Polski</option>
                            </select>
                        </div>
                        
                        <div class="transcription-box" style="min-height: 120px; max-height: 220px; margin-bottom: 8px; background: #1a1a1a; border: 2px solid #FFD700;">
                            <div class="transcription-label" style="color: #FFD700; text-shadow: 0 0 5px #FFD700;">ğŸ“º ×›×ª×•×‘×™×•×ª ×‘×–××Ÿ ×××ª (TV Subtitles)</div>
                            <div id="videoTranscript" style="line-height: 2; font-size: 1.1em; color: #FFFFFF; text-shadow: 0 0 4px #000000; direction: rtl; text-align: center; padding: 12px; min-height: 60px; background: rgba(0,0,0,0.8); border-radius: 6px; white-space: pre-wrap; word-wrap: break-word;"></div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                            <button class="control-btn" onclick="saveVideoTranscriptTXT()" style="border-color: #28a745; color: #28a745; margin-bottom: 0;">
                                ğŸ“„ ×©××•×¨ TXT
                            </button>
                            <button class="control-btn" onclick="saveVideoTranscriptDOCX()" style="border-color: #28a745; color: #28a745; margin-bottom: 0;">
                                ğŸ“‹ ×©××•×¨ DOCX
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- MAIN CHAT AREA -->
        <div class="main-container">
            <button class="toggle-panel-btn" onclick="togglePanel()">
                ğŸ¤
            </button>
            
            <!-- HEADER -->
            <div class="header">
                <h1>ğŸ’› ×—×™-×××ª VOICE</h1>
                <p>Real-Time Transcription + Translation</p>
                <div class="badge">
                    ğŸ“ Transcribed | ğŸ”Š No Speech Output | Binary: 0101-0101(0101)
                </div>
            </div>
            
            <!-- CHAT AREA -->
            <div class="chat-area" id="chatArea">
                <div class="message assistant">
                    <div class="message-wrapper">
                        <div class="message-content">
                            ×©×œ×•×! ğŸ’› ×× ×™ ×—×™-×××ª. ×œ×—×¥ ×¢×œ ğŸ¤ ×‘×¦×“ ×©×××œ ×›×“×™ ×œ×”×§×œ×™×˜!
                        </div>
                        <div class="message-time">×¢×›×©×™×•</div>
                    </div>
                </div>
            </div>
            
            <!-- INPUT AREA -->
            <div class="input-area">
                <div class="input-wrapper">
                    <input 
                        type="text" 
                        id="messageInput" 
                        placeholder="×›×ª×•×‘ ××©×”×•..."
                        autocomplete="off"
                    />
                    <button class="send-btn" onclick="sendMessage()">âœ‰ï¸</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // âš™ï¸ CONFIGURATION
        const PRECISION = 0.0001;
        const BINARY_SIG = "0101-0101(0101)";
        const API_URL = 'https://haiemetweb.onrender.com/exec';
        const TOKEN = 'chai_emet_cXVhbnR1bV9tYXN0ZXI:Rk9SRVZFUl9RVUFOVFVNXzVEOnZiamZwbWNnNjhp';
        
        // ğŸŒ 15 LANGUAGES CONFIGURATION
        const LANGUAGES_CONFIG = {
            'he-IL': { name: 'ğŸ‡®ğŸ‡± ×¢×‘×¨×™×ª', emoji: 'ğŸ’›', label: 'Hebrew' },
            'en-US': { name: 'ğŸ‡ºğŸ‡¸ English', emoji: 'ğŸ’™', label: 'English' },
            'es-ES': { name: 'ğŸ‡ªğŸ‡¸ EspaÃ±ol', emoji: 'ğŸŒº', label: 'Spanish' },
            'fr-FR': { name: 'ğŸ‡«ğŸ‡· FranÃ§ais', emoji: 'ğŸ¥', label: 'French' },
            'de-DE': { name: 'ğŸ‡©ğŸ‡ª Deutsch', emoji: 'ğŸº', label: 'German' },
            'it-IT': { name: 'ğŸ‡®ğŸ‡¹ Italiano', emoji: 'ğŸ', label: 'Italian' },
            'pt-PT': { name: 'ğŸ‡µğŸ‡¹ PortuguÃªs', emoji: 'ğŸ–ï¸', label: 'Portuguese' },
            'ru-RU': { name: 'ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹', emoji: 'â„ï¸', label: 'Russian' },
            'ar-SA': { name: 'ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', emoji: 'ğŸŒ™', label: 'Arabic' },
            'ja-JP': { name: 'ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª', emoji: 'ğŸŒ¸', label: 'Japanese' },
            'zh-CN': { name: 'ğŸ‡¨ğŸ‡³ ä¸­æ–‡', emoji: 'ğŸ®', label: 'Chinese' },
            'ko-KR': { name: 'ğŸ‡°ğŸ‡· í•œêµ­ì–´', emoji: 'ğŸŒŸ', label: 'Korean' },
            'hi-IN': { name: 'ğŸ‡®ğŸ‡³ à¤¹à¤¿à¤¨à¥à¤¦à¥€', emoji: 'ğŸ¨', label: 'Hindi' },
            'nl-NL': { name: 'ğŸ‡³ğŸ‡± Nederlands', emoji: 'ğŸŒ·', label: 'Dutch' },
            'pl-PL': { name: 'ğŸ‡µğŸ‡± Polski', emoji: 'ğŸŒ²', label: 'Polish' }
        };
        
        // ğŸ¤ SPEECH RECOGNITION
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition = null;
        let isRecording = false;
        let transcriptionHistory = [];
        let uploadedFiles = [];
        let currentVoiceLang = 'he-IL';
        let selectedTranslateLang = '';
        let userId = 'user_' + Math.random().toString(36).substr(2, 9);
        
        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.lang = currentVoiceLang;
        }
        
        function getPrecisionTime() {
            return (Date.now() / 1000).toFixed(4);
        }
        
        function getExactTime() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            return `${hours}:${minutes}:${seconds}`;
        }
        
        function togglePanel() {
            const panel = document.getElementById('voicePanel');
            panel.classList.toggle('open');
        }
        
        function clearTranscription() {
            if (confirm('×‘×˜×•×— ×©×¨×•×¦×” ×œ××—×•×§ ××ª ×›×œ ×”×˜×§×¡×˜?')) {
                document.getElementById('finalTranscript').textContent = '';
                document.getElementById('finalTranscript').setAttribute('data-saved', '');
                transcriptionHistory = [];
                console.log('âœ… Transcription cleared');
            }
        }
        
        function toggleUploadAccordion(element) {
            const accordion = document.getElementById('uploadAccordion');
            const arrow = element.textContent.includes('â–¶') ? 'â–¼' : 'â–¶';
            element.textContent = element.textContent.replace(/[â–¶â–¼]/, arrow);
            accordion.style.display = accordion.style.display === 'none' ? 'block' : 'none';
        }
        
        function changeVoiceLanguage() {
            const newLang = document.getElementById('voiceLang').value;
            currentVoiceLang = newLang;
            if (recognition) {
                recognition.lang = currentVoiceLang;
            }
            const langName = LANGUAGES_CONFIG[newLang]?.name || 'Unknown';
            document.getElementById('statusIndicator').textContent = `âœ… Language: ${langName}`;
        }
        
        function toggleRecording() {
            if (!recognition) {
                alert('Speech Recognition not supported');
                return;
            }
            
            if (isRecording) {
                recognition.stop();
                isRecording = false;
                document.getElementById('recordBtn').classList.remove('recording');
            } else {
                // Do NOT clear - just reset interim display
                // Saved text stays via data-saved attribute
                
                recognition.start();
                isRecording = true;
                document.getElementById('recordBtn').classList.add('recording');
                document.getElementById('statusIndicator').textContent = 'ğŸ§ ×××–×™×Ÿ...';
            }
            
            recognition.onstart = () => {
                document.getElementById('statusIndicator').textContent = 'ğŸ§ ×××–×™×Ÿ... ×“×‘×¨ ×¢×›×©×™×•!';
            };
            
            recognition.onresult = (event) => {
                let interimTranscript = '';
                let finalTranscript = '';
                
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript + ' ';
                    } else {
                        interimTranscript += transcript;
                    }
                }
                
                // Get current saved text (never delete)
                const savedText = document.getElementById('finalTranscript').getAttribute('data-saved') || '';
                
                // Show saved text + interim (interim in lighter color)
                if (interimTranscript.trim()) {
                    // Create display with saved + interim
                    const display = savedText ? 
                        savedText + '\n\nğŸ’¬ ' + interimTranscript : 
                        interimTranscript;
                    document.getElementById('finalTranscript').textContent = display;
                } else if (savedText) {
                    document.getElementById('finalTranscript').textContent = savedText;
                }
                
                // ONLY APPEND on final - save permanently
                if (finalTranscript.trim()) {
                    const newSavedText = savedText ? savedText + ' ' + finalTranscript.trim() : finalTranscript.trim();
                    document.getElementById('finalTranscript').textContent = newSavedText;
                    document.getElementById('finalTranscript').setAttribute('data-saved', newSavedText);
                    
                    console.log(`[${getPrecisionTime()}s] Final: "${finalTranscript.trim()}"`);
                    
                    transcriptionHistory.push({
                        text: finalTranscript.trim(),
                        time: getExactTime(),
                        lang: currentVoiceLang
                    });
                    
                    // Send to learning system
                    sendToLearningSystem({
                        type: 'voice_transcription',
                        transcript: finalTranscript.trim(),
                        language: currentVoiceLang,
                        timestamp: getPrecisionTime()
                    });
                    
                    // Auto-translate if language selected
                    if (selectedTranslateLang && finalTranscript.trim()) {
                        translateText(finalTranscript.trim(), selectedTranslateLang);
                    }
                }
            };
            
            recognition.onend = () => {
                isRecording = false;
                document.getElementById('recordBtn').classList.remove('recording');
                document.getElementById('statusIndicator').textContent = 'âœ… Ready';
            };
            
            recognition.onerror = (event) => {
                document.getElementById('statusIndicator').textContent = 'âŒ Error: ' + event.error;
            };
        }
        
        async function translateText(text, targetLang) {
            try {
                const response = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${getLangCode(currentVoiceLang)}|${targetLang}`);
                const data = await response.json();
                
                if (data.responseStatus === 200) {
                    document.getElementById('translatedText').textContent = data.responseData.translatedText;
                }
            } catch (e) {
                console.log('Translation unavailable');
            }
        }
        
        function getLangCode(fullLang) {
            const codes = {
                'he-IL': 'he', 'en-US': 'en', 'es-ES': 'es', 'fr-FR': 'fr',
                'de-DE': 'de', 'it-IT': 'it', 'pt-PT': 'pt', 'ru-RU': 'ru',
                'ar-SA': 'ar', 'ja-JP': 'ja', 'zh-CN': 'zh', 'ko-KR': 'ko',
                'hi-IN': 'hi', 'nl-NL': 'nl', 'pl-PL': 'pl'
            };
            return codes[fullLang] || 'en';
        }
        
        function changeTranslateLanguage() {
            selectedTranslateLang = document.getElementById('translateLang').value;
            const translatedBox = document.getElementById('translatedBox');
            
            // Show/hide translation box
            if (selectedTranslateLang) {
                translatedBox.style.display = 'block';
                
                // Translate current text if exists
                const currentText = document.getElementById('finalTranscript').textContent.trim();
                if (currentText) {
                    translateText(currentText, selectedTranslateLang);
                }
            } else {
                translatedBox.style.display = 'none';
                document.getElementById('translatedText').textContent = '';
            }
        }
        
        function addMessage(text, isUser = false) {
            const messageEl = document.createElement('div');
            messageEl.className = `message ${isUser ? 'user' : 'assistant'}`;
            
            const wrapper = document.createElement('div');
            wrapper.className = 'message-wrapper';
            
            const contentEl = document.createElement('div');
            contentEl.className = 'message-content';
            contentEl.textContent = text;
            
            const timeEl = document.createElement('div');
            timeEl.className = 'message-time';
            timeEl.textContent = getExactTime();
            
            wrapper.appendChild(contentEl);
            wrapper.appendChild(timeEl);
            messageEl.appendChild(wrapper);
            document.getElementById('chatArea').appendChild(messageEl);
            
            document.getElementById('chatArea').scrollTop = document.getElementById('chatArea').scrollHeight;
        }
        
        async function sendMessage() {
            const message = document.getElementById('messageInput').value.trim();
            if (!message) return;
            
            // Show user message immediately with timestamp
            addMessage(message, true);
            document.getElementById('messageInput').value = '';
            document.getElementById('statusIndicator').textContent = 'â³ ××©×“×¨×ª ×ª×’×•×‘×”...';
            
            try {
                // Send to backend API with current language
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'chat',
                        message: message,
                        token: TOKEN,
                        language: currentVoiceLang,  // Send current language
                        userId: userId,
                        timestamp: getPrecisionTime()
                    })
                });
                
                const data = await response.json();
                
                // Show AI response in SAME language
                if (data.reply) {
                    addMessage(data.reply, false);
                    console.log('âœ… Response:', data.reply);
                    console.log('ğŸ“š Learned:', data.learned);
                    console.log('ğŸ§  Learning Patterns:', data.learned_patterns_count);
                }
                
                document.getElementById('statusIndicator').textContent = 'âœ… ×‘×—×–×¨×” ××”×œ×™×‘×”';
                
                // Add to transcription history for learning
                transcriptionHistory.push({
                    text: message,
                    reply: data.reply,
                    time: getPrecisionTime(),
                    lang: currentVoiceLang,
                    learned: data.learned
                });
                
            } catch (error) {
                console.error('Error:', error);
                addMessage('âŒ ×©×’×™××” ×‘×—×™×‘×•×¨ ×œ×œ×™×‘×”. ×‘×“×•×§ ××ª ×”×ª×•×§×Ÿ.', false);
                document.getElementById('statusIndicator').textContent = 'âŒ ×©×’×™××”';
            }
        }
        
        function saveTranscriptionTXT() {
            if (transcriptionHistory.length === 0) {
                alert('××™×Ÿ ×˜×§×¡×˜ ×œ×©××•×¨');
                return;
            }
            
            const content = transcriptionHistory.map((t, i) => 
                `${i + 1}. [${t.time}s] ${t.text}`
            ).join('\n');
            
            const header = `×—×™-×××ª Transcription\n`;
            const metadata = `×©×¤×”: ${LANGUAGES_CONFIG[currentVoiceLang]?.name || 'Unknown'}\n×–××Ÿ: ${new Date().toLocaleString('he-IL')}\n${'='.repeat(50)}\n`;
            const fullContent = header + metadata + content;
            
            const blob = new Blob([fullContent], { type: 'text/plain;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            const filename = `transcription_${Date.now()}.txt`;
            link.download = filename;
            link.click();
            
            uploadedFiles.push({
                name: filename,
                time: getPrecisionTime(),
                type: 'txt',
                size: (blob.size / 1024).toFixed(2) + ' KB'
            });
            updateFilesList();
            addMessage(`ğŸ“„ ×©××•×¨: ${filename}`, false);
        }
        
        function saveTranscriptionDOCX() {
            if (transcriptionHistory.length === 0) {
                alert('××™×Ÿ ×˜×§×¡×˜ ×œ×©××•×¨');
                return;
            }
            
            const sections = transcriptionHistory.map((t, i) => 
                new docx.Paragraph({
                    text: `${i + 1}. [${t.time}s] ${t.text}`,
                    spacing: { line: 360 }
                })
            );
            
            const doc = new docx.Document({
                sections: [{
                    children: [
                        new docx.Paragraph({
                            text: 'ğŸ’› ×—×™-×××ª - Transcription',
                            heading: docx.HeadingLevel.HEADING_1,
                            spacing: { after: 400 }
                        }),
                        new docx.Paragraph({
                            text: `×©×¤×”: ${LANGUAGES_CONFIG[currentVoiceLang]?.name || 'Unknown'}`,
                            spacing: { after: 200 }
                        }),
                        new docx.Paragraph({
                            text: `×–××Ÿ: ${new Date().toLocaleString('he-IL')}`,
                            spacing: { after: 400 }
                        }),
                        ...sections
                    ]
                }]
            });
            
            docx.Packer.toBlob(doc).then(blob => {
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                const filename = `transcription_${Date.now()}.docx`;
                link.download = filename;
                link.click();
                
                uploadedFiles.push({
                    name: filename,
                    time: getPrecisionTime(),
                    type: 'docx',
                    size: (blob.size / 1024).toFixed(2) + ' KB'
                });
                updateFilesList();
                addMessage(`ğŸ“‹ ×©××•×¨: ${filename}`, false);
            });
        }
        
        function handleAudioUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const sizeMB = (file.size / 1024 / 1024).toFixed(2);
            uploadedFiles.push({
                name: file.name,
                time: getPrecisionTime(),
                type: 'audio',
                size: sizeMB + ' MB'
            });
            
            updateFilesList();
            addMessage(`ğŸµ ×”×•×¢×œ×”: ${file.name} (${sizeMB} MB)`, false);
            
            // Try to get duration
            try {
                const url = URL.createObjectURL(file);
                const audio = new Audio();
                audio.addEventListener('loadedmetadata', () => {
                    const duration = (audio.duration / 60).toFixed(2);
                    uploadedFiles[uploadedFiles.length - 1].duration = `${duration} ×“×§×•×ª`;
                    updateFilesList();
                });
                audio.src = url;
            } catch (e) {
                console.log('Cannot get audio duration');
            }
        }
        
        function handleVideoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            uploadedFiles.push({
                name: file.name,
                time: getPrecisionTime(),
                type: 'video',
                size: (file.size / 1024 / 1024).toFixed(2) + ' MB'
            });
            
            updateFilesList();
            addMessage(`ğŸ¬ ×”×•×¢×œ×”: ${file.name}`, false);
        }
        
        function handleTxtUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                const content = e.target.result;
                transcriptionHistory = [];
                content.split('\n').forEach((line, index) => {
                    if (line.trim()) {
                        transcriptionHistory.push({
                            text: line.trim(),
                            time: getPrecisionTime(),
                            lang: currentVoiceLang
                        });
                    }
                });
                
                uploadedFiles.push({
                    name: file.name,
                    time: getPrecisionTime(),
                    type: 'txt',
                    size: (file.size / 1024).toFixed(2) + ' KB',
                    lines: transcriptionHistory.length
                });
                updateFilesList();
                
                document.getElementById('finalTranscript').textContent = content.split('\n')[0] || '';
                addMessage(`ğŸ“„ ×”×•×¢×œ×”: ${file.name} (${transcriptionHistory.length} ×©×•×¨×•×ª)`, false);
            };
            reader.readAsText(file);
        }
        
        function handleDocxUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            uploadedFiles.push({
                name: file.name,
                time: getPrecisionTime(),
                type: 'docx',
                size: (file.size / 1024).toFixed(2) + ' KB'
            });
            
            updateFilesList();
            addMessage(`ğŸ“‹ ×”×•×¢×œ×”: ${file.name} (×œ×¢×™×‘×•×“)`, false);
        }
        
        function updateFilesList() {
            const filesList = document.getElementById('filesList');
            
            if (uploadedFiles.length === 0) {
                filesList.innerHTML = '<div class="empty-files">××™×Ÿ ×§×‘×¦×™× ×¢×“×™×™×Ÿ</div>';
                return;
            }
            
            filesList.innerHTML = '';
            uploadedFiles.forEach((file, index) => {
                const fileEl = document.createElement('div');
                fileEl.className = 'file-item';
                
                let icon = 'ğŸ“„';
                if (file.type === 'txt') icon = 'ğŸ“„';
                if (file.type === 'docx') icon = 'ğŸ“‹';
                if (file.type === 'audio') icon = 'ğŸµ';
                if (file.type === 'video') icon = 'ğŸ¬';
                
                let details = `${file.time}s`;
                if (file.size) details += ` | ${file.size}`;
                if (file.lines) details += ` | ${file.lines} ×©×•×¨×•×ª`;
                if (file.duration) details += ` | ${file.duration}`;
                
                fileEl.innerHTML = `
                    <div class="file-name">${icon} ${file.name}</div>
                    <div style="font-size: 0.7em; color: #999;">${details}</div>
                `;
                filesList.appendChild(fileEl);
            });
        }
        
        function clearAllFiles() {
            if (confirm('×‘×˜×•×—?')) {
                uploadedFiles = [];
                transcriptionHistory = [];
                updateFilesList();
                document.getElementById('finalTranscript').textContent = '';
                document.getElementById('translatedText').textContent = '';
            }
        }
        
        function toggleStreamAccordion(element) {
            const accordion = document.getElementById('streamAccordion');
            const arrow = element.textContent.includes('â–¶') ? 'â–¼' : 'â–¶';
            element.textContent = element.textContent.replace(/[â–¶â–¼]/, arrow) + ' ×•×™×“××• / ×©×“×•×¨ ×—×™';
            accordion.style.display = accordion.style.display === 'none' ? 'block' : 'none';
        }
        
        function showYouTubeInput() {
            document.getElementById('youtubeInputArea').style.display = 'block';
            document.getElementById('liveStreamInputArea').style.display = 'none';
        }
        
        function showLiveStreamInput() {
            document.getElementById('youtubeInputArea').style.display = 'none';
            document.getElementById('liveStreamInputArea').style.display = 'block';
        }
        
        async function loadYouTubeVideo() {
            const url = document.getElementById('youtubeURL').value.trim();
            if (!url) {
                alert('×”×›× ×¡ YouTube URL');
                return;
            }
            
            let videoId = '';
            if (url.includes('youtu.be/')) {
                videoId = url.split('youtu.be/')[1].split('?')[0];
            } else if (url.includes('v=')) {
                videoId = url.split('v=')[1].split('&')[0];
            }
            
            if (videoId) {
                document.getElementById('videoContainer').style.display = 'block';
                const videoPlayerWrapper = document.getElementById('videoPlayerWrapper');
                videoPlayerWrapper.innerHTML = '';
                
                const iframe = document.createElement('iframe');
                iframe.width = '100%';
                iframe.height = '380';
                iframe.src = `https://www.youtube.com/embed/${videoId}`;
                iframe.title = 'YouTube video player';
                iframe.frameBorder = '0';
                iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
                iframe.allowFullscreen = true;
                iframe.style.borderRadius = '8px';
                videoPlayerWrapper.appendChild(iframe);
                
                addMessage(`ğŸ“º YouTube: ${url.substring(0, 50)}...`, false);
            }
        }
        
        async function loadLiveStream() {
            const url = document.getElementById('streamURL2').value.trim();
            if (!url) {
                alert('×”×›× ×¡ Stream URL');
                return;
            }
            
            document.getElementById('videoContainer').style.display = 'block';
            const videoPlayer = document.getElementById('videoPlayer');
            const videoPlayerWrapper = document.getElementById('videoPlayerWrapper');
            videoPlayerWrapper.innerHTML = '';
            
            videoPlayer.src = url;
            videoPlayer.style.display = 'block';
            videoPlayerWrapper.appendChild(videoPlayer);
            
            addMessage(`ğŸ“¡ ×©×™×“×•×¨ ×—×™: ${url.substring(0, 50)}...`, false);
        }
        
        let videoTranscriptHistory = [];
        let currentVideoSubtitles = '';
        let currentVideoTranslations = {};
        
        async function processVideoSubtitles() {
            const subtitles = document.getElementById('videoSubtitles').value.trim();
            if (!subtitles) {
                alert('×”×›× ×¡ ×˜×§×¡×˜ ××”×¡×¨×˜×•×Ÿ');
                return;
            }
            
            currentVideoSubtitles = subtitles;
            currentVideoTranslations = {};
            
            // Display in caption box like TV subtitles
            const langName = LANGUAGES_CONFIG[currentVoiceLang]?.name || 'Unknown';
            const display = `[${langName}]\n\n${subtitles}`;
            document.getElementById('videoTranscript').textContent = display;
            
            // Also keep it visible in the textarea
            document.getElementById('videoSubtitles').value = subtitles;
            
            videoTranscriptHistory = [{
                text: subtitles,
                time: getExactTime(),
                lang: currentVoiceLang
            }];
            
            // Send to learning
            await sendToLearningSystem({
                type: 'video_subtitles',
                transcript: subtitles,
                language: currentVoiceLang,
                timestamp: getPrecisionTime()
            });
            
            addMessage(`ğŸ¬ ×¢×“×›×Ÿ ×›×ª×•×‘×™×•×ª: ${subtitles.substring(0, 30)}...`, false);
            document.getElementById('videoTranslang').focus();
        }
        
        async function updateVideoTranslation() {
            const targetLang = document.getElementById('videoTranslang').value;
            if (!targetLang || !currentVideoSubtitles) return;
            
            document.getElementById('videoTranscript').textContent = 'â³ ××ª×¨×’×...';
            
            try {
                const translated = await translateVideoText(currentVideoSubtitles, targetLang);
                currentVideoTranslations[targetLang] = translated;
                
                // Display like TV captions - show only translation in subtitle area
                const langName = LANGUAGES_CONFIG[targetLang]?.name || targetLang.toUpperCase();
                const display = `[${langName}]\n\n${translated}`;
                document.getElementById('videoTranscript').textContent = display;
                
                // Also show original in a separate info area
                console.log(`ğŸ¬ Original (${LANGUAGES_CONFIG[currentVoiceLang]?.name}):\n${currentVideoSubtitles}`);
                console.log(`ğŸŒ Translation (${langName}):\n${translated}`);
                
                videoTranscriptHistory.push({
                    text: translated,
                    time: getExactTime(),
                    lang: targetLang,
                    translated_from: currentVoiceLang,
                    original: currentVideoSubtitles
                });
                
            } catch (e) {
                document.getElementById('videoTranscript').textContent = 'âŒ ×©×’×™××” ×‘×ª×¨×’×•×';
            }
        }
        
        async function saveVideoTranscriptTXT() {
            if (!currentVideoSubtitles) {
                alert('××™×Ÿ ×›×ª×•×‘×™×•×ª ×œ×©××•×¨');
                return;
            }
            
            let content = `×—×™-×××ª - ×›×ª×•×‘×™×•×ª ×¡×¨×˜×•×Ÿ\n`;
            content += `=${'='.repeat(50)}\n`;
            content += `×ª××¨×™×š: ${new Date().toLocaleString('he-IL')}\n`;
            content += `×©×¤×” ××§×•×¨: ${LANGUAGES_CONFIG[currentVoiceLang]?.name || 'Unknown'}\n`;
            content += `=${'='.repeat(50)}\n\n`;
            content += `ğŸ“º ×˜×§×¡×˜ ××§×•×¨:\n${currentVideoSubtitles}\n\n`;
            
            // Add all translations
            if (Object.keys(currentVideoTranslations).length > 0) {
                content += `ğŸŒ ×ª×¨×’×•××™×:\n${'-'.repeat(50)}\n`;
                for (const [lang, text] of Object.entries(currentVideoTranslations)) {
                    content += `\n[${lang.toUpperCase()}]\n${text}\n`;
                }
            }
            
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            const filename = `video_subtitles_${Date.now()}.txt`;
            link.download = filename;
            link.click();
            
            uploadedFiles.push({
                name: filename,
                time: getPrecisionTime(),
                type: 'video_txt',
                size: (blob.size / 1024).toFixed(2) + ' KB'
            });
            updateFilesList();
            addMessage(`ğŸ“„ ×©××•×¨: ${filename}`, false);
        }
        
        async function saveVideoTranscriptDOCX() {
            if (!currentVideoSubtitles) {
                alert('××™×Ÿ ×›×ª×•×‘×™×•×ª ×œ×©××•×¨');
                return;
            }
            
            const sections = [];
            
            sections.push(new docx.Paragraph({
                text: 'ğŸ“º ×›×ª×•×‘×™×•×ª ×¡×¨×˜×•×Ÿ - ×—×™-×××ª',
                heading: docx.HeadingLevel.HEADING_1,
                spacing: { after: 200 }
            }));
            
            sections.push(new docx.Paragraph({
                text: `×ª××¨×™×š: ${new Date().toLocaleString('he-IL')} | ×©×¤×”: ${LANGUAGES_CONFIG[currentVoiceLang]?.name || 'Unknown'}`,
                spacing: { after: 400 }
            }));
            
            sections.push(new docx.Paragraph({
                text: '×˜×§×¡×˜ ××§×•×¨:',
                heading: docx.HeadingLevel.HEADING_2,
                spacing: { after: 200 }
            }));
            
            sections.push(new docx.Paragraph({
                text: currentVideoSubtitles,
                spacing: { after: 400 }
            }));
            
            // Add translations
            if (Object.keys(currentVideoTranslations).length > 0) {
                sections.push(new docx.Paragraph({
                    text: '×ª×¨×’×•××™×:',
                    heading: docx.HeadingLevel.HEADING_2,
                    spacing: { after: 200 }
                }));
                
                for (const [lang, text] of Object.entries(currentVideoTranslations)) {
                    sections.push(new docx.Paragraph({
                        text: lang.toUpperCase(),
                        heading: docx.HeadingLevel.HEADING_3,
                        spacing: { after: 100 }
                    }));
                    
                    sections.push(new docx.Paragraph({
                        text: text,
                        spacing: { after: 200 }
                    }));
                }
            }
            
            const doc = new docx.Document({
                sections: [{ children: sections }]
            });
            
            docx.Packer.toBlob(doc).then(blob => {
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                const filename = `video_subtitles_${Date.now()}.docx`;
                link.download = filename;
                link.click();
                
                uploadedFiles.push({
                    name: filename,
                    time: getPrecisionTime(),
                    type: 'video_docx',
                    size: (blob.size / 1024).toFixed(2) + ' KB'
                });
                updateFilesList();
                addMessage(`ğŸ“‹ ×©××•×¨: ${filename}`, false);
            });
        }
        
        async function startVideoTranscription(url) {
            // Video started - show message
            document.getElementById('videoTranscript').textContent = 'ğŸ¬ ×¡×¨×˜×•×Ÿ ×‘×”×©××¢×”\n\nğŸ‘‡ ×”×›× ×¡ ××ª ×”×˜×§×¡×˜/×”×›×ª×•×‘×™×•×ª ××”×¡×¨×˜×•×Ÿ ×œ××¢×œ×” ×•×‘×—×¨ ×ª×¨×’×•×';
            
            addMessage(`ğŸ¬ ×¡×¨×˜×•×Ÿ: ${url}`, false);
        }
        
        async function translateVideoText(text, targetLang) {
            try {
                const response = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${getLangCode(currentVoiceLang)}|${targetLang}`);
                const data = await response.json();
                return data.responseStatus === 200 ? data.responseData.translatedText : '';
            } catch (e) {
                return '';
            }
        }
        
        async function sendToLearningSystem(data) {
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'learn',
                        token: TOKEN,
                        data: data,
                        userId: userId
                    })
                });
                const result = await response.json();
                console.log('Learning System:', result);
            } catch (e) {
                console.log('Learning system connection error');
            }
        }
        
        
        let mediaRecorder = null;
        let audioChunks = [];
        let isAudioRecording = false;
        
        async function startAudioStreaming() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];
                isAudioRecording = true;
                
                mediaRecorder.ondataavailable = (event) => {
                    audioChunks.push(event.data);
                };
                
                mediaRecorder.onstop = () => {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                    saveAudioStream(audioBlob);
                };
                
                mediaRecorder.start();
                document.getElementById('statusIndicator').textContent = 'ğŸ™ï¸ ×”×§×œ×˜×ª ××•×“×™×•...';
                
            } catch (error) {
                alert('×©×’×™××”: ' + error.message);
            }
        }
        
        function stopAudioStreaming() {
            if (mediaRecorder && isAudioRecording) {
                mediaRecorder.stop();
                isAudioRecording = false;
                document.getElementById('statusIndicator').textContent = 'âœ… ××•×“×™×• ×©××•×¨';
                mediaRecorder.stream.getTracks().forEach(track => track.stop());
            }
        }
        
        function saveAudioStream(audioBlob) {
            const url = URL.createObjectURL(audioBlob);
            const link = document.createElement('a');
            link.href = url;
            const filename = `audio_stream_${Date.now()}.wav`;
            link.download = filename;
            link.click();
            
            uploadedFiles.push({
                name: filename,
                time: getPrecisionTime(),
                type: 'audio_stream',
                size: (audioBlob.size / 1024).toFixed(2) + ' KB'
            });
            updateFilesList();
            addMessage(`ğŸµ ××•×“×™×• ×©××•×¨: ${filename}`, false);
        }
        
        // Enter key to send message
        document.addEventListener('DOMContentLoaded', () => {
            const messageInput = document.getElementById('messageInput');
            if (messageInput) {
                messageInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendMessage();
                    }
                });
            }
        });
        
        console.log('âœ… Hai-Emet VOICE System Ready!');
        console.log('Binary: ' + BINARY_SIG);
    </script>
</body>
</html>
